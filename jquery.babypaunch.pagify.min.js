$.fn.pagify=function(setting){"use strict";var config={current:1,total:0,pager:10,isText:true,combo:[10,20,30,50],list:20,showListed:true,showCombo:true,showPrevNext:true,showFirstEnd:true,attr:"index",currentClass:"on",html:{total:$("<span>"),first:$("<a>",{"href":"#","text":" ≪ "}),prev:$("<a>",{"href":"#","text":" ＜ "}),num:$("<a>",{"href":"#"}),next:$("<a>",{"href":"#","text":" ＞ "}),end:$("<a>",{"href":"#","text":" ≫ "})}};var method={first:function(min){return{[config.attr]:min-1,"text":min};},prev:function(num,min){var _prev=(num-1)*config.pager-config.pager+1;return _prev<min?{[config.attr]:min-1,"text":min}:{[config.attr]:_prev-1,"text":_prev};},from:function(num){return num===1?1:num*config.pager-config.pager+1;},to:function(num){return num===1?config.pager:num*config.pager;},next:function(num,max){var _next=num*config.pager+1;return _next>max?{[config.attr]:max-1,"text":max}:{[config.attr]:_next-1,"text":_next};},end:function(max){return{[config.attr]:max-1,"text":max};},calculated:function(config,setting){$.extend(true,config,setting);var listed=Math.ceil(config.total/Number(config.list));var paged=Math.ceil(listed/config.pager);var result={listed:listed,paged:paged};for(var i=0;i<=paged;i++){var fromTo=[];var inPaged=false;for(var j=this.from(i),num=j-1;j<=this.to(i);j++,num++){if(j<=listed){if(j===config.current){inPaged=true;}
fromTo.push({[config.attr]:num,"text":j,"isCurrent":j===config.current});}}
if(inPaged){if(config.showFirstEnd&&paged>1&&config.current!==1){result.first=this.first(1);}
if(config.showPrevNext&&config.current>config.pager){result.prev=this.prev(i,1);}
result.fromTo=fromTo;if(config.showPrevNext&&this.next(i,listed).text<this.end(listed).text){result.next=this.next(i,listed);}
if(config.showFirstEnd&&paged>1&&config.current!==listed){result.end=this.end(listed);}}}
$.extend(true,config,result);return config;}};var ui={listed:function(dataset,separator){if(dataset.showListed){return dataset.html.total.text(separator===undefined?dataset.listed:separator+dataset.listed);}},nav:function(name,dataset){if(dataset[name]!==undefined){dataset.html[name][0].setAttribute("data-"+dataset.attr,dataset[name][dataset.attr]);return dataset.html[name];}},pager:function(dataset){var result=[];if(dataset.isText){for(var i=0,fromTo=dataset.fromTo;i<fromTo.length;i++){var $html=undefined;if(fromTo[i].isCurrent){var style=dataset.html.num[0].style.cssText;var $children=dataset.html.num[0].children[0];var child=$children===undefined?"<span>":$children;$html=$(child).text(fromTo[i].text).attr({"style":style}).addClass(dataset.currentClass);}else{$html=dataset.html.num.clone();$html[0].setAttribute("data-"+dataset.attr,fromTo[i][dataset.attr]);$html.attr({"href":"#","style":style}).text(fromTo[i].text);}
result.push($html);}}else{var $html=$("<input>",{"type":"number","min":1,"max":dataset.listed});for(var i=0,fromTo=dataset.fromTo;i<fromTo.length;i++){if(fromTo[i].isCurrent){$html[0].setAttribute("data-"+dataset.attr,fromTo[i][dataset.attr]);$html.val(fromTo[i].text);}}
result.push($html);result.push(this.listed(dataset," / "));}
return result;},select:function(config){var str="";if(config.showCombo){str+="<select>\n";for(var i=0,combo=config.combo;i<combo.length;i++){str+="\t<option value='"+combo[i]+"'"+(Number(config.list)===combo[i]?" selected='selected'":"")+">"
+combo[i]
+"</option>\n";}
str+="</select>\n";}
return str;}};var dataset=method.calculated(config,setting);return this.each(function(){$(this).append(ui.listed(dataset)).append(ui.nav("first",dataset)).append(ui.nav("prev",dataset)).append(ui.pager(dataset)).append(ui.nav("next",dataset)).append(ui.nav("end",dataset)).append(ui.select(dataset));});}
